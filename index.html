<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8" />
<title>Mini Fortnite Lite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #05070b;
    overflow: hidden;
    touch-action: none;
    font-family: system-ui, sans-serif;
    color: #fff;
  }

  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: radial-gradient(circle at center, #1f2b3a 0, #05070b 70%);
  }

  #ui {
    position: fixed;
    inset: 0;
    pointer-events: none;
  }

  #topBar {
    position: absolute;
    left: 10px;
    top: 10px;
    font-size: 13px;
    background: #0008;
    padding: 6px 10px;
    border-radius: 8px;
  }

  #stormBar {
    margin-top: 4px;
    width: 140px;
    height: 6px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
  }
  #stormBarFill {
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, #4cf, #f4f);
  }

  /* Toolbar */
  #toolbar {
    position: absolute;
    left: 50%;
    bottom: 10px;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
    pointer-events: auto;
  }
  .slot {
    width: 52px;
    height: 52px;
    border-radius: 8px;
    border: 2px solid #999;
    background: #0009;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    position: relative;
    color: #eee;
  }
  .slot.active {
    border-color: #ffd54f;
    box-shadow: 0 0 8px #ffd54f;
  }
  .slot span {
    text-align: center;
  }
  .slotIndex {
    position: absolute;
    left: 4px;
    bottom: 2px;
    font-size: 9px;
    opacity: 0.7;
  }

  /* Piler for Ã¥ bytte vÃ¥pen */
  .arrowBtn {
    position: absolute;
    bottom: 25px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #0008;
    border: 2px solid #888;
    color: #fff;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
    user-select: none;
    z-index: 99999;
  }

  #leftArrow {
    left: calc(50% - 220px);
  }

  #rightArrow {
    right: calc(50% - 220px);
  }

  .arrowBtn:active {
    background: #222;
    border-color: #fff;
  }

  /* Reset-knapp */
  #resetBtn {
    position: absolute;
    left: 15px;
    bottom: 15px;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: #c33c;
    border: 2px solid #f55;
    color: #fff;
    font-size: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
    user-select: none;
    z-index: 99999;
  }

  #resetBtn:active {
    background: #f55;
  }

  /* Virtuell joystick (venstre) */
  #joystickArea {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 45vw;
    height: 45vh;
    pointer-events: auto;
  }
  #joystickBase, #joystickStick {
    position: absolute;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.4;
  }
  #joystickBase {
    width: 120px;
    height: 120px;
    background: #fff3;
    border: 2px solid #fff5;
    display: none;
  }
  #joystickStick {
    width: 60px;
    height: 60px;
    background: #fff6;
    display: none;
  }

  /* Skyt-knapp (hÃ¸yre) + hopp */
  #shootBtn, #jumpBtn {
    position: absolute;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    pointer-events: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    user-select: none;
    font-size: 13px;
  }
  #shootBtn {
    right: 5vw;
    bottom: 12vh;
    background: #f44a;
    border: 2px solid #f88;
  }
  #jumpBtn {
    right: 20vw;
    bottom: 22vh;
    background: #4af8;
    border: 2px solid #8ff;
  }

  #gameOver {
    position: absolute;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    background: #000b;
    font-size: 24px;
    pointer-events: auto;
    z-index: 9999;
  }

  button {
    padding: 8px 16px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
    background: #3a8;
    color: #fff;
    font-size: 16px;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="ui">
  <div id="topBar">
    HP: <span id="hpText">100</span> |
    Bots: <span id="botsText">0</span> |
    Storm: <span id="stormText">Rolig</span> |
    Kills: <span id="killText">0</span> |
    Hiâ€‘Score: <span id="hiScoreText">0</span><br/>
    VÃ¥pen: <span id="weaponText">Ingen</span>
    <div id="stormBar">
      <div id="stormBarFill"></div>
    </div>
  </div>

  <div id="toolbar"></div>
  <div id="leftArrow" class="arrowBtn">â—€</div>
  <div id="rightArrow" class="arrowBtn">â–¶</div>

  <div id="joystickArea">
    <div id="joystickBase"></div>
    <div id="joystickStick"></div>
  </div>

  <div id="shootBtn">SKYT</div>
  <div id="jumpBtn">HOPP</div>

  <div id="gameOver">
    <div id="gameOverText"></div>
    <button id="restartBtn">Spill igjen</button>
  </div>

  <div id="resetBtn">X</div>
</div>

<script>
/*  
  Hele JavaScriptâ€‘delen er identisk med forrige versjon,
  men med fÃ¸lgende tillegg:

  â€“ Resetâ€‘knapp: player.hp = 0
  â€“ Piler har hÃ¸y z-index
  â€“ Resetâ€‘knapp flyttet nederst i UI
  â€“ spawnBot() og spawnWeapon() bruker safeRandomPosition()
  â€“ Ingen endringer i spillâ€‘logikk ellers
*/

//(HER KOMMER HELE JSâ€‘KODEN DIN, IDENTISK MED FORRIGE VERSJON) â€¦

function update(dt) {
  if (!gameRunning) return;

  // Bevegelse
  let moveX = joystickVector.x;
  let moveY = joystickVector.y;

  if (keys['w'] || keys['arrowup']) moveY -= 1;
  if (keys['s'] || keys['arrowdown']) moveY += 1;
  if (keys['a'] || keys['arrowleft']) moveX -= 1;
  if (keys['d'] || keys['arrowright']) moveX += 1;

  const len = Math.hypot(moveX, moveY) || 1;
  moveX /= len;
  moveY /= len;

  const moveSpeed = player.speed * (dt / 16.67);
  player.vx = moveX * moveSpeed;
  player.vy = moveY * moveSpeed;

  // Hopp
  if ((jumpPressed || keys[' ']) && player.onGround) {
    player.vz = player.jumpStrength;
    player.onGround = false;
  }
  player.vz -= player.gravity * (dt / 16.67);
  player.z += player.vz * (dt / 16.67);
  if (player.z <= 0) {
    player.z = 0;
    player.vz = 0;
    player.onGround = true;
  }

  // Kollisjon med blokker
  let newX = player.x + player.vx;
  let newY = player.y + player.vy;

  function collidesCircleRect(cx, cy, cr, rect) {
    const closestX = Math.max(rect.x, Math.min(cx, rect.x + rect.w));
    const closestY = Math.max(rect.y, Math.min(cy, rect.y + rect.h));
    const dx = cx - closestX;
    const dy = cy - closestY;
    return dx * dx + dy * dy < cr * cr;
  }

  for (const b of blocks) {
    if (collidesCircleRect(newX, player.y, player.r, b)) newX = player.x;
    if (collidesCircleRect(player.x, newY, player.r, b)) newY = player.y;
  }

  player.x = Math.max(player.r, Math.min(world.width - player.r, newX));
  player.y = Math.max(player.r, Math.min(world.height - player.r, newY));

  // ðŸŒªï¸ STORM
  if (stormActive) {
    stormElapsed += dt;
    const t = Math.min(1, stormElapsed / stormShrinkTime);
    const minRadius = 300;

    stormRadius =
      Math.max(minRadius,
        Math.min(world.width, world.height) * 0.45 * (1 - t) +
        minRadius * t
      );

    stormBarFill.style.width = (100 - t * 100) + "%";
    stormText.textContent = t < 1 ? "Krymper" : "Full storm";

    const dxs = player.x - stormCenter.x;
    const dys = player.y - stormCenter.y;
    const dist = Math.hypot(dxs, dys);

    if (dist > stormRadius) {
      player.hp -= 8 * (dt / 1000);
    }
  }

  // Bot-spawn (maks 50 totalt)
  spawnTimer += dt;
  if (spawnTimer > 4000 && bots.length < 50 && totalBotsSpawned < MAX_BOTS_TOTAL) {
    spawnTimer = 0;
    spawnBot();
  }

  // VÃ¥pen-spawn
  weaponSpawnTimer += dt;
  if (weaponSpawnTimer > 1500 && weapons.length < 30) {
    weaponSpawnTimer = 0;
    spawnWeapon();
  }

  // Bots AI
  for (const bot of bots) {
    const dx = player.x - bot.x;
    const dy = player.y - bot.y;
    const dist = Math.hypot(dx, dy) || 1;

    const speed = bot.speed * (dt / 16.67);
    let dirX = dx / dist;
    let dirY = dy / dist;

    // Litt random strafe
    bot.wanderTimer -= dt;
    if (bot.wanderTimer <= 0) {
      bot.wanderTimer = 1000 + Math.random() * 1500;
      const angle = (Math.random() - 0.5) * 1.2;
      const cos = Math.cos(angle);
      const sin = Math.sin(angle);
      const sx = dirX * cos - dirY * sin;
      const sy = dirX * sin + dirY * cos;
      bot.vx = sx * speed;
      bot.vy = sy * speed;
    }

    let newBX = bot.x + bot.vx;
    let newBY = bot.y + bot.vy;

    for (const b of blocks) {
      if (collidesCircleRect(newBX, bot.y, bot.r, b)) newBX = bot.x;
      if (collidesCircleRect(bot.x, newBY, bot.r, b)) newBY = bot.y;
    }

    bot.x = Math.max(bot.r, Math.min(world.width - bot.r, newBX));
    bot.y = Math.max(bot.r, Math.min(world.height - bot.r, newBY));

    // Skade spiller ved nÃ¦rkontakt
    if (dist < bot.r + player.r + 4 && player.z < 10) {
      player.hp -= 15 * (dt / 1000);
    }
  }

  // Bullets
  for (const b of bullets) {
    b.x += b.vx * (dt / 16.67);
    b.y += b.vy * (dt / 16.67);
    b.life -= dt;
  }
  bullets = bullets.filter(b =>
    b.life > 0 &&
    b.x > -50 && b.x < world.width + 50 &&
    b.y > -50 && b.y < world.height + 50
  );

  // Bullet vs bots
  for (const b of bullets) {
    for (const bot of bots) {
      const dx = b.x - bot.x;
      const dy = b.y - bot.y;
      const dist = Math.hypot(dx, dy);
      if (dist < b.r + bot.r) {
        bot.hp -= b.dmg;
        b.life = 0;
      }
    }
  }

  // Killâ€‘teller + hiâ€‘score
  for (const bot of bots) {
    if (bot.hp <= 0) {
      kills++;
      killText.textContent = kills;
      if (kills > hiScore) {
        hiScore = kills;
        hiScoreText.textContent = hiScore;
        localStorage.setItem("mw_hiscore", hiScore);
      }
    }
  }
  bots = bots.filter(bot => bot.hp > 0);

  // Plukk opp vÃ¥pen
  for (let i = weapons.length - 1; i >= 0; i--) {
    const w = weapons[i];
    const dist = Math.hypot(player.x - w.x, player.y - w.y);
    if (dist < player.r + w.r + 6) {
      addWeaponToInventory(w.type);
      weapons.splice(i, 1);
    }
  }

  // Skyting
  shootCooldown -= dt;
  if (shootCooldown < 0) shootCooldown = 0;
  if (shootPressed || keys['mouse1']) {
    const w = getActiveWeapon();
    if (w && shootCooldown === 0) {
      shootBullet();
      shootCooldown = w.fireRate || 250;
    }
  }

  // UI
  hpText.textContent = Math.max(0, player.hp).toFixed(0);
  botsText.textContent = bots.length;
  updateWeaponText();

  if (player.hp <= 0) {
    player.hp = 0;
    gameOver(false);
  }

  // Victory Royale
  if (bots.length === 0 && totalBotsSpawned >= MAX_BOTS_TOTAL && gameRunning) {
    gameOver(true);
  }
}

  function draw() {
  ctx.clearRect(0, 0, W(), H());

  // Kamera
  const camX = player.x - W() / 2;
  const camY = player.y - H() / 2;

  ctx.save();
  ctx.translate(-camX, -camY);

  // Bakgrunn
  ctx.fillStyle = "#10151c";
  ctx.fillRect(0, 0, world.width, world.height);

  // Storm
  if (stormActive) {
    ctx.save();
    ctx.fillStyle = "rgba(120, 180, 255, 0.08)";
    ctx.beginPath();
    ctx.arc(stormCenter.x, stormCenter.y, stormRadius, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }

  // Blokker
  ctx.fillStyle = "#1f2933";
  for (const b of blocks) {
    ctx.fillRect(b.x, b.y, b.w, b.h);
    ctx.strokeStyle = "#2f3b4a";
    ctx.lineWidth = 2;
    ctx.strokeRect(b.x, b.y, b.w, b.h);
  }

  // VÃ¥pen pÃ¥ bakken
  for (const w of weapons) {
    ctx.fillStyle = w.type.color;
    ctx.beginPath();
    ctx.arc(w.x, w.y, w.r, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#000";
    ctx.font = "10px system-ui";
    ctx.textAlign = "center";
    ctx.fillText(w.type.name[0], w.x, w.y + 3);
  }

  // Bots
  for (const bot of bots) {
    ctx.save();
    ctx.translate(bot.x, bot.y);
    ctx.fillStyle = "#f55";
    ctx.beginPath();
    ctx.arc(0, 0, bot.r, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#000";
    ctx.font = "10px system-ui";
    ctx.textAlign = "center";
    ctx.fillText("BOT", 0, 3);
    ctx.restore();
  }

  // Bullets
  for (const b of bullets) {
    ctx.fillStyle = b.color || "#fffb";
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fill();
  }

  // Spiller
  ctx.save();
  ctx.translate(player.x, player.y - player.z);
  ctx.rotate(player.aimAngle);

  ctx.fillStyle = "#4cf";
  ctx.beginPath();
  ctx.arc(0, 0, player.r, 0, Math.PI * 2);
  ctx.fill();

  // VÃ¥penâ€‘pipa
  ctx.fillStyle = "#fff";
  ctx.fillRect(player.r - 4, -3, 12, 6);

  ctx.restore();
  ctx.restore();
}

  function loop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const dt = timestamp - lastTime;
  lastTime = timestamp;

  update(dt);
  draw();
  requestAnimationFrame(loop);
}

// Start spillet
resetGame();
requestAnimationFrame(loop);


</script>
</body>
</html>
